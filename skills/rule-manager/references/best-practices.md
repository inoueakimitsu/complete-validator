# ルール設計のベスト プラクティス

## ファイルあたりのルール数

- **推奨**: 5-15 個
- **上限目安**: 20 個を超えたら分割を検討します。
- **最小**: 特定の関心事に特化したファイルであれば 1 個でも問題ありません。

ルール数が多すぎると AI のチェック精度が低下する可能性があります。

## ルールの粒度

### 1 つの `## ` セクション = 1 つの関心事

各ルールは 1 つの判定基準のみを扱います。

**悪い例**: 「命名規則とインデント」を 1 つのルールにまとめます。
**良い例**: 「変数の命名規則」と「インデント スタイル」を別々のルールにします。

### ルール説明の具体性

AI が機械的に適用できる具体性で記述します。

| 悪い例 | 良い例 |
|---|---|
| 適切な名前を付ける | 変数名は snake_case を使用する |
| きれいなコードを書く | 1 行は 100 文字以内にする |
| わかりやすいコメントを書く | コメントは丁寧語 (「～です。」「～します。」) で書く |

### Bad/Good 例の数

- **最低**: 1 ペア、必須です。
- **理想**: 異なるパターンをカバーする 2-3 ペアです。
- **上限**: 4-5 ペアです。多すぎるとプロンプトが肥大化します。

複数パターンがある場合は、代表的なケースを優先して例示します。

## `applies_to` によるファイル分割基準

### 言語別 vs 関心事別

分割の軸は 2 つあります。プロジェクトの規模と性質に応じて選択します。

**言語別** (小〜中規模プロジェクト向け):

```
rules/
├── python_style.md        # Python の全ルール
├── typescript_style.md    # TypeScript の全ルール
└── markdown_style.md      # Markdown の全ルール
```

**関心事別** (大規模プロジェクト向け):

```
rules/
├── python_naming.md       # Python の命名規則
├── python_docstring.md    # Python の docstring ルール
├── python_import.md       # Python の import ルール
└── typescript_naming.md   # TypeScript の命名規則
```

### 複数言語に共通するルール

複数の言語に適用されるルール (例: コメント スタイル) は `applies_to` に複数パターンを指定して 1 つのファイルにまとめます。

```yaml
applies_to: ["*.py", "*.md"]
```

言語固有の差異が大きい場合は分割します。

## 例外事項の記述

### 明示的に記述する

暗黙の例外は偽陽性の原因になります。例外は必ず「ただし」で始めて記述します。

```markdown
## Docstrings Required

All public functions must have a docstring.

**Bad:**
...

**Good:**
...

ただし、以下の場合は例外です。

- `__init__.py` の空ファイルには docstring 不要
- テスト ファイル内のヘルパー関数には docstring 不要
```

### 例外の Bad/Good 例

例外条件にも Bad/Good 例を付けると、AI の判定精度が向上します。

```markdown
ただし、簡潔に表現できるものを冗長にしないでください。

**Bad:**
\`\`\`python
# A を指定します。  ← 元が単に "A" で十分な場合、冗長
\`\`\`

**Good:**
\`\`\`python
# A です。
\`\`\`
```

## suppressions.md のガイドライン

### suppression を追加する前に

1. **ルールの修正を検討する**: ルール説明に例外条件を追加することで解消できないか確認します
2. **Bad/Good 例の追加を検討する**: 例を追加することで AI の判定精度を改善できないか確認します
3. **上記で解消できない場合のみ** suppression を追加する

### suppression の粒度

- **具体的に記述する**: どのルール ファイルのどのルールに対する抑制かを明記します
- **理由を記述する**: なぜ偽陽性と判断したかを記述します
- **対象を限定する**: 可能な限り対象ファイルやコードのパターンを限定します

```markdown
# 良い例
- `python_style.md` の docstring 必須ルール: `__init__.py` の空ファイルには docstring 不要

# 悪い例
- docstring のルールを無効化
```

### 定期的な棚卸し

- ルールを修正して偽陽性が解消されたら、該当する suppression を削除する
- 不要になった suppression が残っていても害はないが、メンテナンス性が低下する

## ルール ファイルの命名規則

- スネーク ケース: `python_style.md`、`japanese_comment_style.md`
- 内容を端的に表す名前にする
- 基本パターン: `{言語}_{関心事}.md`
- 言語横断: 関心事のみ (例: `naming_convention.md`)
- ファイルはアルファベット順に読み込まれる (実行順序に影響はない)
